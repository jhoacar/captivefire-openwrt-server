version: '3'

services:
  
  captivefire:
    build:
      context: '.'
      args: 
        UID: ${UID}
        FOLDER: /app
        USERNAME: captivefire
    image: captivefire:openwrt
    deploy:
      resources:
        limits:
          cpus: '${CPU_MHZ_LIMIT:-0.10}'
          memory: '${RAM_MEMORY_LIMIT:-32M}'
        reservations:
          memory: '${RAM_MEMORY_LIMIT:-32M}'
    container_name: captivefire
    # Doesn't work using an init script
    # command: /app/docker/start-container.sh 
    restart: always
    ports:
      - '${APP_HTTP_PORT:-80}:80'
      - 443:443 # HTTPS Port
      - 8080:8080
    volumes:
      - ./docker/etc/config/uhttpd:/etc/config/uhttpd
      - ./docker/etc/php.ini:/etc/php.ini
      - .:/app
